{
  "project": "Boys-Trip",
  "branchName": "ralph/itinerary-manager",
  "description": "Itinerary Manager Role & Edit/Delete Functionality - Allow designated managers to edit/delete activities, and creators to edit their own suggestions",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add manager role to profile schema",
      "description": "As a developer, I need to store a manager role on profiles so the system knows who can edit/delete activities.",
      "acceptanceCriteria": [
        "Add `isItineraryManager` boolean field to profiles table in convex/schema.ts (default: false)",
        "Run `npx convex dev` to apply schema changes",
        "Existing profiles default to non-manager",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Add tracking fields to activities schema",
      "description": "As a developer, I need to track who created and last edited an activity.",
      "acceptanceCriteria": [
        "Add `creatorProfileId` (optional Id<'profiles'>) field to activities table for user-suggested activities",
        "Add `lastEditedBy` (optional string) field to activities table",
        "Add `lastEditedAt` (optional number/timestamp) field to activities table",
        "Existing activities have these fields as undefined",
        "Update `suggestActivity` mutation to accept and store `creatorProfileId`",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Add manager context provider",
      "description": "As a developer, I need a React context to efficiently check manager status across components.",
      "acceptanceCriteria": [
        "Create `ManagerContext` provider in app/components/ManagerContext.tsx",
        "Provider fetches current user's profile using localStorage userId",
        "Exposes `isManager` boolean and `managerProfile` object via useManager hook",
        "Wrap itinerary page with this provider in app/itinerary/page.tsx",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create edit activity mutation",
      "description": "As a developer, I need a backend mutation that allows authorized users to update activity details.",
      "acceptanceCriteria": [
        "Create `updateActivity` mutation in convex/itinerary.ts",
        "Accepts: activityId, updated fields (title, description, location, cost, timeSlot, day, imageUrl, externalLink), editorProfileId",
        "Validates that editorProfileId is EITHER a manager OR the activity's creator (for user-suggested activities)",
        "AI-generated activities (source: 'ai') can only be edited by managers",
        "Updates `lastEditedBy` with editor's name and `lastEditedAt` with Date.now()",
        "Returns updated activity",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create delete activity mutation",
      "description": "As a developer, I need a backend mutation that allows managers to delete activities with cascading cleanup.",
      "acceptanceCriteria": [
        "Create `deleteActivity` mutation in convex/itinerary.ts",
        "Accepts: activityId, deleterProfileId",
        "Validates that deleterProfileId belongs to a profile with isItineraryManager: true",
        "Deletes all votes associated with the activity using by_activity index",
        "Deletes all comments associated with the activity using by_activity index",
        "Deletes the activity itself",
        "Returns success confirmation object",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create manager designation UI in profile",
      "description": "As an admin, I want to mark specific profiles as itinerary managers so they can manage the itinerary.",
      "acceptanceCriteria": [
        "Create `setItineraryManager` mutation in convex/profiles.ts that toggles isItineraryManager",
        "Add 'Itinerary Manager' toggle/badge visible on profile view page (app/profile/[id]/page.tsx)",
        "Only show toggle to admins (check localStorage 'boys-trip-admin')",
        "Enforce maximum of 2 managers - show warning if limit reached (query count of managers)",
        "Toggle calls setItineraryManager mutation",
        "Visual indicator (orange badge) shows manager status on profile",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create edit activity modal",
      "description": "As an itinerary manager or activity creator, I want a form to edit activity details.",
      "acceptanceCriteria": [
        "Create EditActivityModal component in app/components/EditActivityModal.tsx",
        "Modal form pre-populated with current activity data",
        "Editable fields: title, description, location, cost, day (1-10 dropdown), timeSlot (Morning/Afternoon/Evening), imageUrl, externalLink",
        "Save button calls `updateActivity` mutation with current user's profileId",
        "Cancel button closes modal without saving",
        "Loading state shown while saving (disable button, show spinner)",
        "On success: close modal. On error: show error message",
        "Style consistent with existing SuggestActivityForm component",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add edit button to ActivityCard for authorized users",
      "description": "As an itinerary manager or activity creator, I want to see an edit button on activity cards I can modify.",
      "acceptanceCriteria": [
        "Add edit icon/button to ActivityCard component (app/components/ActivityCard.tsx)",
        "Button visible to managers (on all activities) using useManager context",
        "Button visible to creators (on their own user-suggested activities where creatorProfileId matches)",
        "Unauthorized users do not see edit button",
        "Clicking button opens EditActivityModal with that activity's data",
        "Add EditActivityModal state management to itinerary page",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add delete button to ActivityCard for managers",
      "description": "As an itinerary manager, I want to delete activities that are no longer relevant.",
      "acceptanceCriteria": [
        "Add delete icon/button to ActivityCard component (app/components/ActivityCard.tsx)",
        "Button visible only to managers using useManager context",
        "Clicking shows confirmation dialog: 'Delete this activity? Votes and comments will also be removed.'",
        "Confirm button calls `deleteActivity` mutation",
        "Activity removed from UI in real-time via Convex reactivity",
        "Cancel button closes dialog without action",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Display 'Last edited by' on activity cards",
      "description": "As a user, I want to see if an activity was edited and by whom for transparency.",
      "acceptanceCriteria": [
        "If activity has `lastEditedBy` field, show 'Edited by [name]' text on ActivityCard",
        "Use subtle styling: text-sm text-gray-500 so it doesn't dominate the card",
        "Add title attribute showing relative timestamp (e.g., '2 hours ago') on hover",
        "Activities without lastEditedBy show nothing extra",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    }
  ]
}
